<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Access-Control-Allow-Origin" content="*" />

    <title>Title</title>
    <!-- 引入样式 -->
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
</head>

<style>
    body{ text-align:center}
    .div{ margin: 200px; width:500px; height:300px}
    /* css注释：为了观察效果设置宽度 边框 高度等样式 */
</style>


<body>

<div id="app" class="div" >
    <template v-if="login_display">
    <el-input    v-model="username" placeholder="用户名"></el-input>
    <el-input   v-model="password" placeholder="密码" show-password></el-input>
    <el-button   v-on:click="login">Login</el-button>
    </template>
    <template v-if="authorize_display">
        <el-radio v-model="chosen" label="true">同意授权</el-radio>
        <el-radio v-model="chosen" label="false">拒绝授权</el-radio>
        <el-button   v-on:click="confirm">确认</el-button>

    </template>

</div>

</body>

<!-- import Vue before Element -->
<script src="https://unpkg.com/vue/dist/vue.js"></script>
<!-- import JavaScript -->
<script src="https://unpkg.com/element-ui/lib/index.js"></script>
<script src="https://cdn.bootcss.com/qs/6.5.2/qs.min.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>

<script>

    new Vue({

        el: '#app',
        data: {
            client_id: "clientId",
            redirect_uri: "http://127.0.0.1",
            username: "",
            password: "",
            authorize_display : false,
            login_display: true,
            cookie: "",
            chosen: false,
        },
        methods:{
            login : function () {
                const data = {
                    "username": this.username,
                    "password": this.password,
                    "cookie":""
                };

                const options = {
                    method: 'POST',
                    changeOrigin: true,
                    headers: {
                        'content-type': 'application/x-www-form-urlencoded'
                    },
                    data: Qs.stringify(data),
                    url: "http://localhost:10098/login",
                }

                axios(options).then((response) => {
                    this.cookie = response.data
                    this.login_display = false
                    this.authorize_display = true
                }).catch((err) => {
                    Vue.prototype.$message.error('账号密码错误')
                })
            },
            confirm: function () {
                if(this.chosen){
                    axios.get("http://localhost:10098/oauth/authorize", {
                        params: {
                            client_id: this.client_id,
                            redirect_uri: this.redirect_uri
                        },
                        changeOrigin: true,
                        headers: {
                            "user-cookie": this.cookie
                        }
                    }).then((response) => {
                        this.window = response.data
                    })

                }
            }

        }
    })
</script>
</html>